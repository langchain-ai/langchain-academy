# The Simplest Graph

シンプルなグラフを3つのノードと1つの条件付きエッジで構築してみましょう。

## State

まず、グラフの[State](状態)を定義します。

State schemaは、グラフ内のすべてのノードとエッジの入力スキーマとして機能します。

キーの型ヒントを提供するPythonの`typing`モジュールの`TypedDict`クラスをスキーマとして使用しましょう。

## Nodes

[Nodes]はただのPython関数です。

第1引数は上記で定義した状態です。

状態は上記で定義したスキーマを持つ`TypedDict`なので、各ノードは`state['graph_state']`でキー`graph_state`にアクセスできます。

各ノードは状態キー`graph_state`の新しい値を返します。

デフォルトでは、各ノードから返される新しい値は以前の状態値を[上書き]します。

## Edges

[Edges]はノード同士を接続します。

通常のエッジは、例えば`node_1`から`node_2`に*常に*移動したい場合に使用します。

[条件付きエッジ]は、ノード間を*オプションで*ルーティングしたい場合に使用します。

条件付きエッジは、何らかのロジックに基づいて次に訪問するノードを返す関数として実装されます。

## Graph Construction

これで、上記で定義した[コンポーネント]からグラフを構築できます。

[StateGraphクラス]は使用できるグラフクラスです。

まず、上記で定義した`State`クラスでStateGraphを初期化します。

次に、ノードとエッジを追加します。

ユーザー入力をグラフに送る特別なノードである[`START`ノード]を使用して、グラフの開始点を示します。

[`END`ノード]は終端ノードを表す特別なノードです。

最後に、グラフ構造の基本的なチェックを行うためにグラフを[コンパイル]します。

グラフは[Mermaidダイアグラム]として可視化できます。

## Graph Invocation

コンパイルされたグラフは[runnable]プロトコルを実装します。

これはLangChainコンポーネントを実行する標準的な方法を提供します。

`invoke`はこのインターフェースの標準メソッドの1つです。

入力は辞書`{"graph_state": "Hi, this is lance."}`で、graph state dictの初期値を設定します。

`invoke`が呼び出されると、グラフは`START`ノードから実行を開始します。

定義されたノード(`node_1`, `node_2`, `node_3`)を順番に進みます。

条件付きエッジは50/50の判定ルールを使用してノード1からノード2または3に移動します。

各ノード関数は現在の状態を受け取り、新しい値を返し、それがgraph stateを上書きします。

実行は`END`ノードに到達するまで継続します。

`invoke`はグラフ全体を同期的に実行する。

これは各ステップが完了するのを待ってから次のステップに移る。

全てのノードが実行された後、グラフの最終的な状態を返す。
